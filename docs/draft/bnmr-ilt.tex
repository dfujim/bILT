\documentclass[
  aps,
  prb,
  twocolumn,
  reprint,
  superscriptaddress,
  floatfix,
  citeautoscript,
  longbibliography,
]{revtex4-2}

% font/input character encodings
\usepackage[T1]{fontenc} 
\usepackage[utf8]{inputenc}

% "good" times-like text/math fonts
\usepackage{newtxtext}
\usepackage{newtxmath}

\usepackage{graphicx}
\usepackage{siunitx}
\usepackage{chemformula}
\usepackage{booktabs}
\usepackage[english]{babel}
\usepackage{csquotes}
\usepackage{mathtools}

% hyperlinks
\usepackage[
  unicode,
  colorlinks = true,
  allcolors = blue,
]{hyperref}

% context sensitive references (must load after hyperref)
\usepackage{cleveref}

% microtypographical optimizations
\usepackage{microtype}

% automatic abbreviations
\usepackage{glossaries}
\glsdisablehyper
\input{acronyms.tex}
%\makeglossaries

% semantic markup of Latin abbreviations
% \newcommand{\latin}[1]{\emph{#1}}
\newcommand{\latin}[1]{#1}

\begin{document} 

\title{On ``inverse Laplace transforms'' as a mean of analyzing \ch{^{8}Li} spin-lattice relaxation}

\newcommand{\ubcsbqmi}{Stewart Blusson Quantum Matter Institute, University of British Columbia, Vancouver, BC V6T~1Z4, Canada}
\newcommand{\ubcchem}{Department of Chemistry, University of British Columbia, Vancouver, BC V6T~1Z1, Canada}
\newcommand{\ubcphas}{Department of Physics and Astronomy, University of British Columbia, Vancouver, BC V6T~1Z1, Canada}
\newcommand{\triumf}{TRIUMF, 4004 Wesbrook Mall, Vancouver, BC V6T~2A3, Canada}

\author{Derek~Fujimoto}
\email[]{fujimoto@phas.ubc.ca}
\affiliation{\ubcsbqmi}
\affiliation{\ubcphas}

\author{Ryan~M.~L.~McFadden}
\email[]{rmlm@chem.ubc.ca}
\affiliation{\ubcsbqmi}
\affiliation{\ubcchem}

\author{W.~Andrew~MacFarlane}
\email[]{wam@chem.ubc.ca}
\affiliation{\ubcsbqmi}
\affiliation{\ubcchem}
\affiliation{\triumf}

\date{\today}

\begin{abstract}
Here we explore the use of \glspl{ilt} as a means of analyzing \gls{slr} data obtained in ion-implanted \ch{^{8}Li} \gls{bnmr} experiments.
\dots
The results are consistent with conclusions arrived at from a diligent ``classical'' analysis, but with significantly less effort and additional information.
We anticipate this approach will be an indispensable complementary means of analyzing \gls{bnmr} \gls{slr} spectra, particularly in materials comprised of:
multilayers,
random disorder,
or depth dependent properties.
\end{abstract}

\maketitle
\glsresetall

\section{Introduction \label{sec:introduction}}

In the last few decades, ion-implanted \gls{bnmr} has established itself as unique microscopic probe of condensed matter~\cite{2015-MacFarlane-SSNMR-68-1}.
In many respects it is quite similar \gls{musr}, with differences in the nuclear properties of the implanted probes making the two techniques complimentary rather than competitors~\cite{2000-Kiefl-PB-289-640}.

The most common \gls{bnmr} probe \ch{^{8}Li} often exhibits multi-exponential relaxation, complicating analysis.
Its high nuclear spin $I = 2$ is unique among (stable) \gls{nmr} nuclei, yielding fundamentally bi-exponential quadrupole relaxation~\cite{1970-Hubbard-JCP-53-985, 1982-Becker-ZNA-37-697, 1985-Korblein-JPFMP-15-561}.
In an experiment, especially in complex materials, it is not known beforehand if the multi-exponential polarization transients are due to:
multiple \ch{^{8}Li} stopping sites with distinct $T_{1}$s;
quadrupolar relaxation at a single site;
a distribution of relaxation times;
or combinations of the above possibilities.
In such cases, extreme care is required during the analysis when selecting a model to describe the data.
The same is especially true for the interpretation.
Both may be tackled through due diligence and exhaustive testing, but the process is hardly expedient.
It has therefore been desirable to have complementary means of addressing these uncertainties (\latin{e.g.}, what is the \emph{distribution} of $T_{1}$).
To this end, we explore the use of \glspl{ilt} as an alternative approach to analyzing \ch{^{8}Li} \gls{bnmr} \gls{slr} data.

Recall that \glspl{ilt} are useful when considering an experimental signal that has the form:
\begin{equation}
\label{eq:signal-integral}
   y(t) = \int_{0}^{\infty} p(\lambda) \exp ( - \lambda t) \, \mathrm{d} \lambda,
\end{equation}
where $\lambda$ is the relaxation rate and $p ( \lambda )$ is its amplitude or probability density.
The implicit goal of the analysis is to determine $p ( \lambda )$, which can, in principle, be obtained by taking the \gls{ilt} of the transient $y(t)$:
\begin{equation}
\label{eq:ilt}
   p ( \lambda ) = \frac{1}{2 \pi \imath} \int_{c - \imath \infty}^{c + \imath \infty} y(t) \exp ( \lambda t ) \, \mathrm{d} t ,
\end{equation}
where $c$ is a real constant.

Evaluating the integral in \Cref{eq:ilt}, sometimes referred to as the Bromwich integral, is straightforward so long as $y(t)$ is known analytically;
however, \emph{this is almost never the case in experimental science}!
\textbf{See review on exponential analysis for more details~\cite{1999-Istratov-RSI-70-1233}.}
Pragmatically, $p ( \lambda )$ can only be found through solving \Cref{eq:signal-integral}.
Note that \Cref{eq:signal-integral} is a member of the more general class of Fredholm integral equations of the first kind.
These integrals are known to be ``ill'', ``incorrectly'', or ``improperly'' posed.
That is, the solution $p ( \lambda )$ obtained on solving \Cref{eq:signal-integral} may not be unique or even exist!

To deal with this \textbf{\dots more needed here!}
At this juncture, it is worth mentioning the ``\gls{ilt}'' is somewhat inappropriate language, as discussed in detail elsewhere~\cite{2017-Fordham-DF-29-2}.
Nevertheless, we preserve the nomenclature for consistency with the \gls{nmr} literature.



The use of \glspl{ilt} is not uncommon in conventional \gls{nmr}, especially in complex solutions (\latin{e.g.}, in the petroleum industry).


% Assuming only that our signal can be written as a sum of exponentially decaying terms, we.


The rest of the paper is organized as follows:
in \Cref{sec:theory} we outline the details of the ``\gls{ilt}'' analysis, including some particulars to \gls{bnmr} \gls{slr} data;
results from the approach are presented in \Cref{sec:results},
followed by a discussion in \Cref{sec:discussion}.
Finally, a concluding summary is given in \Cref{sec:conclusion}.


\section{Theory \label{sec:theory}}

In a \gls{bnmr} experiment, the experimental observable is the $\beta$-decay asymmetry $A(t)$, measured by the normalized difference in counting rates between two opposing detectors $N_{i}$.
Because of the parity violation in $\beta$-decay, $A(t)$ is proportional to nuclear spin-polarization $P(t)$ of the $\beta$-emitting probes.
That is,
\begin{equation}
   A(t) = A_{0} P(t),
\end{equation}
where the proportionality factor $A_{0}$ the depends on the details of the $\beta$-decay and the geometric details of the experiment.
The quantity of real interest is $P(t)$, whose temporal behaviour is connected with the fundamental properties of the host material.

In order to introduce the \gls{bnmr} probes in a host material of interest, they are ion-implanted using a \gls{dc} beam for a finite period of time $\Delta$, typically on the order of few seconds.
On arrival, each \gls{bnmr} probe interacts with electromagnetic fields inside the host and relaxes (\latin{i.e.}, re-orients);
however, not all probes arrive at the same time, which must be accounted for.
Fortunately, this convolution with the beam can be solved analytically with the time dependence of $P(t)$ written as~\cite{2006-Salman-PRL-96-147601, 2015-MacFarlane-PRB-92-064409}:
\begin{equation} \label{eq:polarization}
   P(t) = P_{0} \times
   \begin{cases}
      \frac{ \displaystyle \int_{0}^{t} \exp \left [ -\left ( t - t^{\prime} \right ) / \tau_{\beta} \right ] \, R \left (t,t^{\prime} \right ) \, \mathrm{d}t^{\prime} }{ \displaystyle \int_{0}^{t} \exp \left [ -t^{\prime} / \tau_{\beta} \right ] \, \mathrm{d}t^{\prime} }, & t \leq \Delta \\
      \frac{ \displaystyle \int_{0}^{\Delta} \exp \left [ - \left ( \Delta - t^{\prime} \right ) / \tau_{\beta} \right ] \,  R \left (t, t^{\prime} \right ) \, \mathrm{d}t^{\prime} }{ \displaystyle \int_{0}^{\Delta} \exp \left [ -t^{\prime} / \tau_{\beta} \right ] \, \mathrm{d} t^{\prime} }, & t > \Delta
   \end{cases}
\end{equation}
where $t^{\prime} < t$ is the arrival time of the probe, $P_{0}$ is the degree of polarization at $t = 0$ (determined by the optical pumping of \ch{^{8}Li} prior to implantation), $\Delta$ is the duration of the beam pulse, and $R \left (t, t^{\prime} \right )$ is the relaxation function.


Quite generally, $R \left (t, t^{\prime} \right )$ can be written as a distribution of decaying exponentials
\begin{equation} \label{eq:slr-integral}
   R \left (t, t^{\prime} \right ) = \int_{0}^{\infty} p ( \lambda ) \exp \left [-  \lambda \left ( t - t^{\prime} \right ) \right ] \, \mathrm{d} \lambda ,
\end{equation}
where $\lambda \equiv 1 / T_{1}$ is the \gls{slr} rate and $p ( \lambda )$ is the probability density.
This is quite analogous to \Cref{eq:signal-integral}.
In practice, spectra are often well-described (at the level of phenomenology) by a stretched exponential or \gls{kww} function~\cite{1854-Kohlrausch-AP-167-179, 1970-Williams-TFS-66-80, 1980-Lindsay-JCP-73-3348, 2006-Johnston-PRB-74-184430, 2016-Wu-SR-6-20506}.
In this case \Cref{eq:slr-integral} becomes:
\begin{equation} \label{eq:slr-stretched}
   R \left ( t, t^{\prime} \right ) \approx \exp \left \{ - \left  [ \lambda \left ( t-t^{\prime} \right ) \right ]^{\beta} \right \},
\end{equation}
where $\lambda \equiv 1/T_{1}$ is the relaxation rate and $0 < \beta \leq 1$ is the stretching exponent.
This form of $R \left ( t, t^{\prime} \right )$ is quite general and can arise from a continuous distribution of exponential relaxation times~\cite{2006-Johnston-PRB-74-184430}, with special cases of $\beta = 1/2$~\cite{1968-Tse-PRL-21-511, 1984-Stockmann-JNCS-66-501} or $\beta = 1/3$~\cite{1992-Bader-JPCM-4-4779} coming from \gls{slr} that is inhomogenously averaged in \gls{3d} or \gls{2d} limits.
The approach is often used in conventional solid-state \gls{nmr}~\cite{1995-Narayanan-JMRSA-112-58}, though chiefly as an expedient simplification of the multi-exponential magnetization transients, particularly when quadrupolar interactions are present~\cite{1995-McDowell-JMRSA-113-242}.
%In disordered or glassy materials like polymers a distribution of relaxation times is expected and a stretched exponential works works well~\cite{2014-McKenzie-JACS-136-7833, 2014-McGee-JPCS-551-012039, 2015-McKenzie-SM-11-1755, 2017-McKenzie-JCP-146-244903, 2018-McKenzie-SM-14-7324, 2019-Fujimoto-CM-31-9346}.
%While it may not be \latin{a priori} obvious why a relaxation transient appears stretched, the function has the following advantages as a phenomenological model:
%1) it accurately captures the characteristic $1/e$ relaxation time;
%and 2) it contains relatively few degrees of freedom (\latin{i.e.}, less than a biexponential model).


\textbf{A better transition needed here?}


We now begin the process of determining $p ( \lambda )$.
To start, we recast \Cref{eq:slr-integral} in discrete form, yielding
\textbf{(the notation should probably be improved\dots)}
%\begin{equation}
%\label{eq:signal-discrete}
%y ( t_{i} ) = \sum_{j} P( \lambda_{j} ) \exp ( - \lambda_{j} t_{i}) ,
%\end{equation}
\begin{equation} \label{eq:slr-sum}
   R \left (t_{i}, t^{\prime} \right ) = \sum_{j} p ( \lambda_{j} ) \exp \left [- \lambda_{j} \left ( t_{i} - t^{\prime} \right ) \right ] .
\end{equation}
With this transformation, we conveniently write $P(t)$ in matrix form:
\begin{equation} \label{eq:signal-matrix}
   \mathbf{P} = K \mathbf{p},
\end{equation}
where $K$ is the kernel matrix with elements
\begin{equation}
   \label{eq:kernel}
   [K]_{ij} \propto \exp \left ( - \lambda_{j} t_{i} \right )
\end{equation}
and $\mathbf{p}$ is the vector containing the associated amplitudes.
Of course, this can be easily re-cast as a vector of probability densities:
\begin{equation}
   \tilde{\mathbf{p}} = \frac{ \mathbf{p} }{ \sum_{i} [p]_{i} } .
\end{equation}



To solve the discretized problem, the goal is to
\begin{equation}
   \label{eq:onnls}
   \arg \min_{\mathbf{P} \geq 0} || \Sigma \left ( K \mathbf{p} - \mathbf{y} \right ) ||^{2} ,
\end{equation}
where $\Sigma$ is a diagonal matrix containing the uncertainies

This is a \gls{nnls} problem.
While straightforward, success is not guaranteed.
Matrix inversion is unstable \dots
\textbf{
Need to mention the details of the data itself:
histograms (\latin{i.e.}, discrete points in time) with inhomogeneous (statistical) uncertainties.
One has the freedom to adjust the time resolution of the spectra, up to a maximum determined at the time of data acquisition.
For \ch{^{8}Li}, a typical minimum bin width is \SI{10}{\milli\second}, which is a factor of \num{\sim 121} smaller than its nuclear lifetime.
}


To overcome this potentially show-stopping detail, \emph{regularization} is often introduced to increase the stability of the inversion.
This is done through the addition of a penalty term with a scale factor $\alpha$.
With this modification, \Cref{eq:onnls} becomes
\begin{equation}
\label{eq:rnnls}
   \arg \min_{\mathbf{p} \geq 0} || K \mathbf{p} - \mathbf{y} ||^{2} + \alpha || \mathbf{p} ||^{2} .
\end{equation}
\Cref{eq:rnnls} is commonly known as Tikhonov regularization~\cite{1995-Tikhonov-NMSIPP} or ridge regression.
Effectively, the added term $\alpha || \mathbf{p} ||^{2}$ seeks to prevent the coefficients in $\mathbf{p}$ from adopting large values without incurring a penalty.
Pragmatically, this has the effect that, when $\alpha = 0$, $\mathbf{p}$ is most likely to contain elements close to 1 (\latin{i.e.}, giving a ``spiky'' solution).
Conversely, when $\alpha = \infty$, it forces the elements of $\mathbf{p}$ tend to zero, as $\alpha || \mathbf{p} ||^{2}$ is the dominant contribution to \Cref{eq:rnnls}.
As $\alpha$ grows, it tends to broaden $\mathbf{p}(\lambda)$.
Within the bounds $0 \leq \alpha \leq \infty$, there exists an ``optimum'' for the scale or smoothing parameter;
however, it is not known \latin{a priori} and must be determined for meaningful results.




Note, however, that \Cref{eq:rnnls} is \emph{not} the only form that the penalty ``add on'' can take!
Similarly, note that $\alpha$ \emph{must} be ``tuned'' in order for meaningful result to be obtained.


\Cref{eq:rnnls} can be solved using non negative least squares~\cite{1995-Lawson-SLSP}.



When it comes to finding the ``optimal'' $\alpha$, there are several approaches~\cite{2001-Kilmer-SIAMJMAA-22-1204}.
So, so many approaches~\cite{2011-Bauer-MCS-81-1795}, in fact!


One common approach is the so-called Butler-Reeds-Dawson method~\cite{1981-Butler-SIAMJNMA-18-381}, but this does not appear to apply here because our statistical errors/noise are intrinsically inhomogeneous across a spectrum.
\textbf{Is this the same as the ``the discrepancy principle''~\cite{1966-Morozon-DANSSR-167-510}?}
\textbf{It is possible this approach may work? See Eqs.~(7.9)--(7.10) on pp.~180--181 in~\cite{1998-Hansen-RDDIPP}.}
This is in contrast to, for example, an inversion-recovery NMR experiment, where the level of noise can be determined, in principle, by turning off the RF amplifier.



Independent of the minimization step, we can define the fit quality as:
\begin{equation}
   \chi^{2} = || \Sigma \left ( K \mathbf{p} - \mathbf{y} \right ) ||^{2} ,
\end{equation}
which is the familiar (weighted) sum of the squared residuals.




\gls{gcv} approach~\cite{1978-Craven-NM-31-377}:
Define
\begin{equation}
\label{eq:gcv}
   \min_{\alpha \geq 0} G ( \alpha ) = \frac{ || K \mathbf{p} - \mathbf{y} ||^{2} }{ \tau ( \alpha )^{2} } ,
\end{equation}
where
\begin{equation}
   \tau ( \alpha ) = \mathrm{Tr} \left [ \mathbf{I} - K \left ( K^{T} K + \alpha^{2} L^{T} L \right )^{-1} K^{T} \right ] .
\end{equation}
One can use an alternative method targeted at cases when $K$ is large~\cite{1997-Golub-JCGS-6-1}.
It is generally difficult to minimize $G ( \alpha )$ as it is generally flat.



Use L-curve analysis.
Visualize the size of the solution $|| \mathbf{p} ||$ vs.\ the residual $|| K \mathbf{p} - \mathbf{y} ||$ as a parametric plot for different $\alpha$.
Find the $\alpha$ that is the ``corner'' of the L-curve.
This is equivalent to to maximizing $\alpha$ up to the point where its becomes detrimental to the ``fit''.
In some cases where a minimum in $|| K \mathbf{p} - \mathbf{y} ||$ is pronounced, the $\alpha$ satisfying the ``corner'' condition is obvious.



\section{Results \label{sec:results}}


\section{Discussion \label{sec:discussion}}


\section{Conclusion \label{sec:conclusion}}

We have shown \dots
We feel this method of analysis will be particularly useful when studying materials of inherent complexity, such as:
heterostructures and multilayers;
glassy and disordered systems;
or any sample with depth-dependent properties.

\begin{acknowledgments}
This work was supported by an \gls{nserc} Discovery Grant awarded to W.A.M,
with additional support to D.F. provided by a QuEST fellowship.
\end{acknowledgments}


\appendix

\section{Miscellaneous \label{sec:miscellaneous}}

discussion of pitfalls~\cite{1983-Varah-SIAMJSSC-4-164}.

L-curve regularization~\cite{1992-Hansen-SIAMR-34-561, 1993-Hansen-SIAMJSC-14-1487}.
An earlier example~\cite{1990-Hansen-SIAMJSSC-11-503}?

Nice high-level article~\cite{1994-Craig-CP-8-648}.

bridge vs.\ lasso regularization methods~\cite{1998-Wenjiang-JCGS-7-397}.

\cite{2002-Venkataramanan-IEEETSP-50-1017}.

Review of \glspl{ilt} in noisy \gls{nmr} data~\cite{2013-Berman-CMRPA-42-72}.

Discussion of what exactly are \glspl{ilt}~\cite{2017-Fordham-DF-29-2}.

(see \latin{e.g.}, the classic textbook on the subject~\cite{1995-Lawson-SLSP}).

see also fairly recent multiexponential analysis review~\cite{1999-Istratov-RSI-70-1233} and numerical recipes~\cite{numerical-recipies}.

A recent, long review on regularization methods~\cite{2018-Benning-AN-27-1}.

Triangle method for finding the corner of the L-curve~\cite{2002-Castellanos-ANM-43-359}.

Example of using weights like we do~\cite{1999-Dunn-JMR-140-153}.

Some papers mention application to muons~\cite{1984-Honig-JCAM-10-113}.

People are still writing theses on regularization (see \latin{e.g.},~\cite{2011-OrozcoRodriguez-PhD}).

Paper with explicit re-casting of the equations being solved~\cite{2001-OLeary-SIAMJSC-23-1161} --- good to check against our implementation.

Another book by an authority on the topic~\cite{1998-Hansen-RDDIPP}.


\bibliography{references.bib,others.bib}


\end{document}
